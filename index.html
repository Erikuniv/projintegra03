<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Manutenção</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            background-color: #f0f0f0;
            padding: 20px;
        }
        .header {
            margin-bottom: 20px;
        }
        .form-section {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table-section {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-action {
            color: white;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .btn-save {
            background-color: #4CAF50;
        }
        .btn-edit {
            background-color: #2196F3;
        }
        .btn-complete {
            background-color: #FF9800;
        }
        .btn-delete {
            background-color: #f44336;
        }
        .btn-refresh {
            background-color: #9E9E9E;
        }
        .btn-pdf {
            background-color: #607D8B;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <h1>GESTÃO DE MANUTENÇÃO</h1>
        </div>

        <div class="form-section">
            <form id="maintenanceForm">
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="maintenanceType" class="form-label">Tipo de Manut.:</label>
                            <select class="form-select" id="maintenanceType">
                                <option value="">Selecione...</option>
                                <option value="Preventiva">Preventiva</option>
                                <option value="Corretiva">Corretiva</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="equipment" class="form-label">Equipamento:</label>
                            <input type="text" class="form-control" id="equipment">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="expectedDate" class="form-label">Data Previsão:</label>
                            <input type="text" class="form-control datepicker" id="expectedDate">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="completionDate" class="form-label">Data Conclusão:</label>
                            <input type="text" class="form-control datepicker" id="completionDate">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="responsible" class="form-label">Responsável:</label>
                            <input type="text" class="form-control" id="responsible">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="status" class="form-label">Status:</label>
                            <select class="form-select" id="status">
                                <option value="">Selecione...</option>
                                <option value="Em andamento">Em andamento</option>
                                <option value="Atrasada">Atrasada</option>
                                <option value="Concluída">Concluída</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="description" class="form-label">Descrição:</label>
                            <input type="text" class="form-control" id="description">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="cost" class="form-label">Custo:</label>
                            <input type="text" class="form-control" id="cost" placeholder="R$ 0,00">
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="actions-section mb-3">
            <button class="btn btn-save btn-action" onclick="saveData()">Salvar</button>
            <button class="btn btn-edit btn-action" onclick="editData()">Editar Ordem</button>
            <button class="btn btn-complete btn-action" onclick="completeOrder()">Concluir Ordem</button>
            <button class="btn btn-delete btn-action" onclick="deleteOrder()">Excluir Ordem</button>
            <button class="btn btn-refresh btn-action" onclick="refreshData()">Atualizar</button>
            <button class="btn btn-pdf btn-action" onclick="generatePDF()">Gerar PDF</button>
        </div>

        <div class="table-section">
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="maintenanceTable">
                    <thead class="table-dark">
                        <tr>
                            <th>Número Ordem</th>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Data Previsão</th>
                            <th>Data Conclusão</th>
                            <th>Responsável</th>
                            <th>Status</th>
                            <th>Equipamento</th>
                            <th>Custo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample data - in a real app this would be populated from a database -->
                        <tr>
                            <td>123456</td>
                            <td>Preventiva</td>
                            <td>Manutenção periódica</td>
                            <td>15/06/2023</td>
                            <td>15/06/2023</td>
                            <td>João Silva</td>
                            <td>Concluída</td>
                            <td>Compressor A</td>
                            <td>R$ 1.200,00</td>
                        </tr>
                        <tr>
                            <td>654321</td>
                            <td>Corretiva</td>
                            <td>Troca de peça</td>
                            <td>20/06/2023</td>
                            <td>22/06/2023</td>
                            <td>Maria Souza</td>
                            <td>Em andamento</td>
                            <td>Esteira B</td>
                            <td>R$ 850,50</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal for Edit -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Editar Ordem</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="editMaintenanceType" class="form-label">Tipo:</label>
                            <select class="form-select" id="editMaintenanceType">
                                <option value="Preventiva">Preventiva</option>
                                <option value="Corretiva">Corretiva</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editEquipment" class="form-label">Equipamento:</label>
                            <input type="text" class="form-control" id="editEquipment">
                        </div>
                        <div class="mb-3">
                            <label for="editExpectedDate" class="form-label">Data Previsão:</label>
                            <input type="text" class="form-control datepicker" id="editExpectedDate">
                        </div>
                        <div class="mb-3">
                            <label for="editCompletionDate" class="form-label">Data Conclusão:</label>
                            <input type="text" class="form-control datepicker" id="editCompletionDate">
                        </div>
                        <div class="mb-3">
                            <label for="editResponsible" class="form-label">Responsável:</label>
                            <input type="text" class="form-control" id="editResponsible">
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status:</label>
                            <select class="form-select" id="editStatus">
                                <option value="Em andamento">Em andamento</option>
                                <option value="Atrasada">Atrasada</option>
                                <option value="Concluída">Concluída</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editDescription" class="form-label">Descrição:</label>
                            <input type="text" class="form-control" id="editDescription">
                        </div>
                        <div class="mb-3">
                            <label for="editCost" class="form-label">Custo:</label>
                            <input type="text" class="form-control" id="editCost">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveEdit()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
    <script>
        // Initialize date pickers
        flatpickr(".datepicker", {
            dateFormat: "d/m/Y",
            locale: "pt"
        });

        // Generate random order number
        function generateOrderNumber() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Save data function
        function saveData() {
            // Validate form
            const form = document.getElementById('maintenanceForm');
            const inputs = form.querySelectorAll('input, select');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value) {
                    isValid = false;
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                alert('Preencha todos os campos');
                return;
            }
            
            // Validate cost
            const costInput = document.getElementById('cost');
            const costValue = costInput.value.replace('R$', '').replace('.', '').replace(',', '.');
            if (isNaN(parseFloat(costValue))) {
                alert('Custo inválido');
                costInput.classList.add('is-invalid');
                return;
            }
            
            // Format cost
            const formattedCost = parseFloat(costValue).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            
            // Add to table (in a real app, this would be an AJAX call to a backend)
            const table = document.getElementById('maintenanceTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            
            newRow.innerHTML = `
                <td>${generateOrderNumber()}</td>
                <td>${document.getElementById('maintenanceType').value}</td>
                <td>${document.getElementById('description').value}</td>
                <td>${document.getElementById('expectedDate').value}</td>
                <td>${document.getElementById('completionDate').value}</td>
                <td>${document.getElementById('responsible').value}</td>
                <td>${document.getElementById('status').value}</td>
                <td>${document.getElementById('equipment').value}</td>
                <td>${formattedCost}</td>
            `;
            
            // Clear form
            form.reset();
            alert('Dados inseridos com sucesso!');
        }

        // Edit data function
        function editData() {
            const table = document.getElementById('maintenanceTable');
            const selectedRow = table.querySelector('tr.selected');
            
            if (!selectedRow) {
                alert('Selecione um item para editar');
                return;
            }
            
            // Get data from selected row
            const cells = selectedRow.cells;
            
            // Fill modal form
            document.getElementById('editMaintenanceType').value = cells[1].textContent;
            document.getElementById('editEquipment').value = cells[7].textContent;
            document.getElementById('editExpectedDate').value = cells[3].textContent;
            document.getElementById('editCompletionDate').value = cells[4].textContent;
            document.getElementById('editResponsible').value = cells[5].textContent;
            document.getElementById('editStatus').value = cells[6].textContent;
            document.getElementById('editDescription').value = cells[2].textContent;
            document.getElementById('editCost').value = cells[8].textContent;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('editModal'));
            modal.show();
        }

        // Save edit function
        function saveEdit() {
            const table = document.getElementById('maintenanceTable');
            const selectedRow = table.querySelector('tr.selected');
            
            if (selectedRow) {
                // Update row with edited values
                selectedRow.cells[1].textContent = document.getElementById('editMaintenanceType').value;
                selectedRow.cells[7].textContent = document.getElementById('editEquipment').value;
                selectedRow.cells[3].textContent = document.getElementById('editExpectedDate').value;
                selectedRow.cells[4].textContent = document.getElementById('editCompletionDate').value;
                selectedRow.cells[5].textContent = document.getElementById('editResponsible').value;
                selectedRow.cells[6].textContent = document.getElementById('editStatus').value;
                selectedRow.cells[2].textContent = document.getElementById('editDescription').value;
                selectedRow.cells[8].textContent = document.getElementById('editCost').value;
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                modal.hide();
                
                alert('Dados atualizados com sucesso!');
            }
        }

        // Complete order function
        function completeOrder() {
            const table = document.getElementById('maintenanceTable');
            const selectedRow = table.querySelector('tr.selected');
            
            if (!selectedRow) {
                alert('Selecione um item para concluir');
                return;
            }
            
            selectedRow.cells[6].textContent = 'Concluída';
            alert('Ordem marcada como concluída!');
        }

        // Delete order function
        function deleteOrder() {
            const table = document.getElementById('maintenanceTable');
            const selectedRow = table.querySelector('tr.selected');
            
            if (!selectedRow) {
                alert('Selecione um item para excluir');
                return;
            }
            
            if (confirm('Deseja realmente excluir esta ordem?')) {
                selectedRow.remove();
                alert('Ordem excluída com sucesso!');
            }
        }

        // Refresh data function
        function refreshData() {
            // In a real app, this would reload data from the server
            alert('Dados atualizados!');
        }

        // Generate PDF function
        function generatePDF() {
            // In a real app, this would generate a PDF report
            alert('Relatório PDF gerado como "relatorio_manutencao.pdf"');
        }

        // Add row selection functionality
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.getElementById('maintenanceTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let row of rows) {
                row.addEventListener('click', function() {
                    // Remove selected class from all rows
                    for (let r of rows) {
                        r.classList.remove('selected', 'table-primary');
                    }
                    
                    // Add selected class to clicked row
                    this.classList.add('selected', 'table-primary');
                });
            }
        });
    </script>
</body>
</html>